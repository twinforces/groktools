PatchBuilder
PatchBuilder is a user-side tool for generating .grokpatch files, which encapsulate changes between two versions of a Python script. It produces patches compatible with Grok’s copypasta boxes and grokpatcher.
Overview

Purpose: Create .grokpatch files to update scripts, ensuring compatibility with grokpatcher.
Input: Old and new versions of a Python script.
Output: A .grokpatch file containing:
Metadata: !INPUT: <path> and !OUTPUT: <path> for file paths.
Unified Diff: A diff generated by diff -u, with escaped backticks (e.g., \code`) for copypasta compatibility, following docs/prompts/diffu_prompt.md`.
EOF Marker: !GO! at the end to signal patch completion.



Usage

Prerequisites:

Python 3.8+.
GNU diff (diff):
macOS: brew install diffutils
Linux: Typically pre-installed as diff.


GNU patch (gpatch):
macOS: brew install gpatch (system patch is unreliable).
Linux: Typically pre-installed as patch.




Run patchBuilder.py:
python src/patchBuilder.py --old old_script.py --new new_script.py --output patch.grokpatch


Version Increment:

VERSION constant incrementing (e.g., VERSION = "1.0" to VERSION = "1.1") is handled on the Grok side when generating .grokpatch files, typically via docs/prompts/versioning_prompt.md.


Output .grokpatch:

The tool generates a .grokpatch file with metadata, a unified diff, and a !GO! marker.
Backticks are escaped for copypasta compatibility.


Example .grokpatch:
!INPUT: script.py
!OUTPUT: script.py
--- script.py
+++ script.py
@@ -1,3 +1,4 @@
 def main():
     print("Hello")
-    print("World")
+    print("Grok with \`code\`")
     return
!GO!


Manual Diff Extraction (Optional):
python src/diffextract.py patch.grokpatch | gpatch -p1



Workflow

Input Preparation: Provide old and new script versions.
Patch Generation: patchBuilder.py compares versions using diff -u and creates a .grokpatch.
Patch Application: Use grokpatcher.py to apply the .grokpatch, with diffextract.py extracting and unescaping the diff for gpatch.

Standards

Unified diffs align with GNU diffutils (https://savannah.gnu.org/projects/diffutils).
See docs/prompts/diffu_prompt.md for diff standards, a Grok-side tool prompt in the Grok programming language.

Notes

Backticks are escaped in .grokpatch files to prevent issues in Grok’s copypasta boxes, unescaped by diffextract.py.
patchBuilder.py and diffextract.py are user-side tools, using diff -u and gpatch, independent of Grok.
VERSION incrementing is managed by Grok, not patchBuilder.py, ensuring consistency with Grok-side versioning tools.
For Grok’s interaction guidelines, see docs/prompts/grokpatcher_prompt.md, a Grok-side tool prompt.
For applying patches, see docs/grokpatcher.md.

