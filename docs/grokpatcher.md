GrokPatcher
GrokPatcher is a service-based tool for applying .grokpatch files to Python scripts, designed to integrate with Grok’s copypasta boxes (code blocks). It processes patches using natural and artificial anchors, ensuring robust updates for complex projects.
Overview

Purpose: Apply .grokpatch files to scripts, enabling seamless updates with Grok’s assistance.
Input: .grokpatch files containing:
Metadata: !INPUT: <path> and !OUTPUT: <path> for file paths.
Unified Diff: A diff generated by diff -u, with escaped backticks (e.g., \code`) for copypasta compatibility, following docs/prompts/diffu_prompt.md`.
EOF Marker: !GO! at the end to signal patch completion.
Patch Set Terminator: !DONE! to end multiple patches.


Output: Updated scripts after applying the diff with gpatch.

Usage

Prerequisites:

Python 3.8+.
GNU patch (gpatch):
macOS: brew install gpatch (system patch is unreliable).
Linux: Typically pre-installed as patch.


GNU diff (diff):
macOS: brew install diffutils
Linux: Typically pre-installed as diff.


Ensure input files specified in !INPUT exist.


Run grokpatcher.py:
python src/grokpatcher.py


Paste .grokpatch Files:

Copy each .grokpatch from Grok’s copypasta boxes.
Paste into the grokpatcher.py prompt.
Repeat for multiple patches.
Paste !DONE! to complete the patch set.


Patch Application:

grokpatcher.py parses the .grokpatch, validates metadata, and uses diffextract.py to extract and unescape the unified diff, applying it with gpatch.


Example .grokpatch:
!INPUT: script.py
!OUTPUT: script.py
--- script.py
+++ script.py
@@ -1,3 +1,4 @@
 def main():
     print("Hello")
-    print("World")
+    print("Grok with \`code\`")
     return
!GO!


Manual Diff Extraction (Optional):
python src/diffextract.py file.grokpatch | gpatch -p1



Workflow

Generation: Grok (using docs/prompts/grokpatcher_prompt.md) or patchBuilder.py (using diff -u) creates .grokpatch files with escaped backticks.
Application: Users paste .grokpatch files into grokpatcher.py, which processes and applies them using diffextract.py and gpatch.
Completion: !DONE! signals the end of a patch set.

Error Handling

Invalid Metadata: Checks for missing or non-existent input files.
Malformed Diff: Validates diff format (e.g., ---, +++, hunk markers).
gpatch Errors: Logs errors (e.g., malformed patches, file mismatches).

Standards

Unified diffs align with GNU diffutils (https://savannah.gnu.org/projects/diffutils).
See docs/prompts/diffu_prompt.md for diff standards.

Notes

Backticks are escaped in .grokpatch files to ensure compatibility with copypasta boxes, unescaped by diffextract.py.
grokpatcher.py and diffextract.py are user-side tools, using diff -u and gpatch, independent of Grok.
For Grok’s interaction guidelines, see docs/prompts/grokpatcher_prompt.md, a Grok-side tool prompt in the Grok programming language.

